---
title: "Storage"
number-sections: true
---

## Overview {#sec-overview}

Access to SeaBee data is provided by MinIO, which offers high-performance, S3-compatible object storage. At the highest level, files within MinIO are organised into **buckets**. For example, there are currently buckets for `niva`, `nina`, `ntnu` etc. Within these, files are organised within folders and sub-folders, just like a standard file system. At present, each organisation is responsible for organising their data in a way that fits with their existing workflows. 

:::{.callout-note}
Eventually, we will define a common file and folder structure for all SeaBee data, as this will make it easier to automate common SeaBee tasks.
:::

To access the data on MinIO, you first need to [create an account](./login.qmd#sec-minio). You can then login to the [SeaBee MinIO web interface](https://minio.seabee.sigma2.no/login) (@fig-minio-console-window) and browse files in a similar way to e.g. DropBox or GoogleDrive. If you need to work with SeaBee data from your code, there is also an S3-compatible storage endpoint at <https://storage.seabee.sigma2.no> (see @sec-upload-download for details). 

## Backups {#sec-backups}

 Files stored on NIRD follow the regular backup schedule described [here](https://documentation.sigma2.no/files_storage/backup.html#nird). For the GeoNode databases, backups should be dumped to the `seabee-backup-restore` bucket (which is then backed-up via the standard NIRD regime).

## Uploading and downloading files {#sec-upload-download}

There are several options to upload and download files to/from the MinIO storage.

### MinIO web interface {#sec-minio-ui}
 
 The minio console located at <https://minio.seabee.sigma2.no/login> provides a graphical interface to upload and download files (@fig-minio-console-window). 
 
 ![MinIO Console.](./images/minio_console_window.png){#fig-minio-console-window}

 On the [buckets page](https://minio.seabee.sigma2.no/buckets), click `Browse -> Upload`, then select either `Upload Folder` or `Upload File`. To download, mark the desired folder/file and click `Download`.

### SeaBee data upload portal {#sec-data-portal}

 * Describe Deb's data upload portal
 * Best option for standard/less advanced users?

### Machine Access {#sec-machine-access}

To accesss the S3 API on <https://storage.seabee.sigma2.no> you first need a service account (generated [here](https://minio.seabee.sigma2.no/identity/account)).

#### Python {#sec-python}

 All python libaries supporting the S3 API will be able to interact with the MinIO storage. One good option is the [MinIO SDK](https://min.io/docs/minio/linux/developers/python/minio-py.html). In addition to upload and download, this has options to search and manage access and to retrieve metadata etc. A simple SeaBee-specific example using the MinIO client is [here](https://nbviewer.org/github/SeaBee-no/snippets/blob/main/storage.ipynb) and more general examples are [here](https://github.com/minio/minio-py/tree/master/examples). If you need file-like access, the [S3Fs](https://s3fs.readthedocs.io/en/latest/) library for Python is also a good option.

#### Shell {#sec-shell}

##### Rclone {-}

 [Rclone](https://rclone.org/) provides a convenient way of synchronising files `local -> cloud` or `cloud -> cloud`. Rclone keeps track of transferred files and will retry if the connection is interrupted, so **it is probably the best option for experienced/advanced users to add large volumes of imagery to Sigma2**.

###### Setup {-}

 To install rclone follow the [instructions](https://rclone.org install/) for your operating system, it is a single excutable that you can download.

 The quickest way to add minio seabee as an rclone remote is to edit/create the `rclone.conf` file. Check the location of this file by running the command

 ```bash
 rclone config file
 ```

 if the file does not exist create it. Then add this section

 ```txt
 [seabee-minio]
type = s3
provider = Minio
access_key_id = <ACCESS_KEY_ID>
secret_access_key = <SECRET_ACCESS_KEY>
endpoint = storage.seabee.sigma2.no
```   

 where `<ACCESS_KEY_ID>` can be your user name or a service account, and `<SECRET_ACCESS_KEY>` is the accompanying password.

 To check that everything is working run this command

```bash
rclone lsd seabee-minio:
```

it should list the buckets on minio.

The configuration setup can also be completed by following rclone's interactive config session. This can be started using

```bash
rclone config
```

For most cases use the default, the storage type to select is `S3 compliant` .i.e. option `5)` and endpoint is `storage.seabee.sigma2.no`. This also allows you to setup a wide range of other remotes:)


###### Usage {-}


 **IMPORTANT!** It is quite convenient to setup autocomplete for rclone, see [genautocomplete](https://rclone.org/commands/rclone_genautocomplete/), now rclone completes commands and paths when you press `TAB`.

 Some nice commands to know about is `rclone mount --read-only`, `rclone copy`, and `rclone sync`, in addition to commands like `ls`, `mkdir` and `rclone help`.




